!function(a){"object"==typeof module&&"object"==typeof module.exports?a(require("jquery"),window,document):a(jQuery,window,document)}(function(f,h,b,a){var g=[],c=function(){return g.length?g[g.length-1]:null},d=function(){var e,i=!1;for(e=g.length-1;e>=0;e--){g[e].$blocker&&(g[e].$blocker.toggleClass("current",!i).toggleClass("behind",i),i=!0)}};f.modal=function(m,k){var j,l;if(this.$body=f("body"),this.options=f.extend({},f.modal.defaults,k),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),this.$blocker=null,this.options.closeExisting){for(;f.modal.isActive();){f.modal.close()}}if(g.push(this),m.is("a")){if(l=m.attr("href"),this.anchor=m,/^#/.test(l)){if(this.$elm=f(l),1!==this.$elm.length){return null}this.$body.append(this.$elm),this.open()}else{this.$elm=f("<div>"),this.$body.append(this.$elm),j=function(e,i){i.elm.remove()},this.showSpinner(),m.trigger(f.modal.AJAX_SEND),f.get(l).done(function(e){if(f.modal.isActive()){m.trigger(f.modal.AJAX_SUCCESS);var n=c();n.$elm.empty().append(e).on(f.modal.CLOSE,j),n.hideSpinner(),n.open(),m.trigger(f.modal.AJAX_COMPLETE)}}).fail(function(){m.trigger(f.modal.AJAX_FAIL);var e=c();e.hideSpinner(),g.pop(),m.trigger(f.modal.AJAX_COMPLETE)})}}else{this.$elm=m,this.anchor=m,this.$body.append(this.$elm),this.open()}},f.modal.prototype={constructor:f.modal,open:function(){var e=this;this.block(),this.anchor.blur(),this.options.doFade?setTimeout(function(){e.show()},this.options.fadeDuration*this.options.fadeDelay):this.show(),f(b).off("keydown.modal").on("keydown.modal",function(i){var j=c();27===i.which&&j.options.escapeClose&&j.close()}),this.options.clickClose&&this.$blocker.click(function(i){i.target===this&&f.modal.close()})},close:function(){g.pop(),this.unblock(),this.hide(),f.modal.isActive()||f(b).off("keydown.modal")},block:function(){this.$elm.trigger(f.modal.BEFORE_BLOCK,[this._ctx()]),this.$body.css("overflow","hidden"),this.$blocker=f('<div class="'+this.options.blockerClass+' blocker current"></div>').appendTo(this.$body),d(),this.options.doFade&&this.$blocker.css("opacity",0).animate({opacity:1},this.options.fadeDuration),this.$elm.trigger(f.modal.BLOCK,[this._ctx()])},unblock:function(e){!e&&this.options.doFade?this.$blocker.fadeOut(this.options.fadeDuration,this.unblock.bind(this,!0)):(this.$blocker.children().appendTo(this.$body),this.$blocker.remove(),this.$blocker=null,d(),f.modal.isActive()||this.$body.css("overflow",""))},show:function(){this.$elm.trigger(f.modal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=f('<a href="#close-modal" rel="modal:close" class="close-modal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.modalClass).appendTo(this.$blocker),this.options.doFade?this.$elm.css({opacity:0,display:"inline-block"}).animate({opacity:1},this.options.fadeDuration):this.$elm.css("display","inline-block"),this.$elm.trigger(f.modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(f.modal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove();var e=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){e.$elm.trigger(f.modal.AFTER_CLOSE,[e._ctx()])}):this.$elm.hide(0,function(){e.$elm.trigger(f.modal.AFTER_CLOSE,[e._ctx()])}),this.$elm.trigger(f.modal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||f('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},_ctx:function(){return{elm:this.$elm,$elm:this.$elm,$blocker:this.$blocker,options:this.options,$anchor:this.anchor}}},f.modal.close=function(j){if(f.modal.isActive()){j&&j.preventDefault();var e=c();return e.close(),e.$elm}},f.modal.isActive=function(){return g.length>0},f.modal.getCurrent=c,f.modal.defaults={closeExisting:!0,escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",modalClass:"modal",blockerClass:"jquery-modal",spinnerHtml:'<div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div>',showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},f.modal.BEFORE_BLOCK="modal:before-block",f.modal.BLOCK="modal:block",f.modal.BEFORE_OPEN="modal:before-open",f.modal.OPEN="modal:open",f.modal.BEFORE_CLOSE="modal:before-close",f.modal.CLOSE="modal:close",f.modal.AFTER_CLOSE="modal:after-close",f.modal.AJAX_SEND="modal:ajax:send",f.modal.AJAX_SUCCESS="modal:ajax:success",f.modal.AJAX_FAIL="modal:ajax:fail",f.modal.AJAX_COMPLETE="modal:ajax:complete",f.fn.modal=function(e){return 1===this.length&&new f.modal(this,e),this},f(b).on("click.modal",'a[rel~="modal:close"]',f.modal.close),f(b).on("click.modal",'a[rel~="modal:open"]',function(e){e.preventDefault(),f(this).modal()})});